define(["angular","app","lodash","settings","jquery"],function(t,e,c,n,r){"use strict";e.directive("topicPanel",function(t){return{templateUrl:"/components/topics/pannel/topic-panel.html",scope:{topic:"="},link:function(e,c){e.countdownPause=function(){t(function(){r(c).find(".progress-bar").addClass("paused")})}},controller:function(t,e,r,i,o){t.imageEnabled=!1,t.checkedOpt=[],t.uploadPath=n.upload.path,t.setOptBgColorByUser=function(e){var c=t.verdict;if(c&&c.user){var n=r.getCurrentUser();return c.opt.indexOf(e)>-1&&c.user.id!==n.id?"#"+o.getUserMousePointerColor(t.verdict.user.id)||"":""}};var d=function(e){t.verdict=e,t.$emit("topicVerdict",e),t.verdictCls="",e&&(t.countdownPause(),t.verdict.user?t.verdict.verdict?t.verdictCls="correct":t.verdictCls="incorrect":t.verdictCls="timeout")};e.register("topicVerdict",function(e){d(e),o.updateState(),t.$apply()}),t.$watch("topic",function(e){e&&e._id&&(d(null),t.checkedOpt=[])}),t.check=function(n){t.verdict||(t.checkedOpt.indexOf(n)>-1?t.checkedOpt=c.without(t.checkedOpt,n):t.checkedOpt.push(parseInt(n,10)),t.topic.answercount===t.checkedOpt.length&&(t.countdownPause(),e.topicCheckOpt(t.checkedOpt.join(""))))},t.showTip=function(){var e=t.topic;return!e.hasOwnProperty("corrector")&&!c.isEmpty(t.checkedOpt)&&e.answercount&&e.answercount-t.checkedOpt.length>0}}}})});